(function(){!function(a){return a.fn.stuck=function(b){var c;return new(c=function(){function b(b){this.window=b,this.body=a("body"),this.loadElements(),this.calculateTopOffset(),this.isIOS()&&this.body.on({touchmove:function(a){return function(){return a.update()}}(this)}),this.window.scroll(function(a){return function(){return a.update()}}(this)),this.window.resize(function(a){return function(){return a.resize()}}(this)),this.update()}return b.prototype.elements=[],b.prototype.resizing=!1,b.prototype.isIOS=function(){return this._isIOS||(this._isIOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent))},b.prototype.resize=function(){this.resizing=!0,this.calculateTopOffset(),this.update()},b.prototype.loadElements=function(){var b,c,d,e,f,g,h,i,j,k,l;for(d=a(".stuck"),e=d.length,l=0;e--;){for(g=d.eq(l),l++,h=!1,c="",b=g.attr("class").split(/\s+/),i=a("<div/>"),k=b.length;k--;)f=b[k],"release"===f&&(h=!0,c=g.closest(".release-container")),"stuck"!==f&&"release"!==f&&i.addClass(f);i.height(g.outerHeight()).hide().css("background-color","transparent").insertBefore(g),j=g.offset().top-parseInt(g.css("margin-top")),this.elements.push({node:g,spacer:i,top:j,top_offset:0,fixed:!1,release:h,container:c,contained:!1})}},b.prototype.calculateTopOffset=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;for(g=[],f=this.elements.length,k=0;f--;)if(d=this.elements[k],k++,l=g.length,0===l)d.release||g.push([d]);else{for(a=!1;l--&&!a;)for(h=0,e=g[l],m=e.length;m--;)i=e[m],c=this.collide(i.node,d.node),c?(j=i.top_offset+i.node.outerHeight(!0),j>h&&(h=j),a=!0,b=null!=g[l+1]?l+1:-1):0===l&&(b=0);a?(d.top_offset=h,d.release||(b>=0?g[b].push(d):g.push([d]))):(d.top_offset=0,d.release||g[0].push(d))}},b.prototype.collide=function(a,b){var c,d;return c=a.offset().left,d=b.offset().left,c===d?!0:d>c?Math.floor(c)+a.width()>Math.ceil(d)?!0:!1:Math.floor(d)+b.width()>Math.ceil(c)?!0:!1},b.prototype.update=function(){var a,b,c;for(c=this.window.scrollTop(),b=this.elements.length;b--;)a=this.elements[b],this.resizing&&(a.top=a.fixed?a.spacer.offset().top-parseInt(a.spacer.css("margin-top")):a.node.offset().top-parseInt(a.node.css("margin-top")),a.fixed&&a.node.css({top:a.top_offset,left:a.spacer.offset().left,width:a.spacer.outerWidth()}),a.contained&&c>a.container.offset().top+a.container.height()-a.node.height()-a.top_offset&&a.node.css({position:"absolute",top:a.container.height()-a.node.height(),left:"",width:"","z-index":""})),a.fixed&&a.release&&!a.contained&&c>a.container.offset().top+a.container.height()-a.node.height()-a.top_offset&&(a.contained=!0,a.container.css("position","relative"),a.node.css({position:"absolute",top:a.container.height()-a.node.height(),left:"",width:"","z-index":""})),a.contained&&c<a.container.offset().top+a.container.height()-a.node.height()-a.top_offset&&(a.contained=!1,a.container.css("position",""),a.node.css({position:"fixed",top:a.top_offset,left:a.spacer.offset().left,width:a.spacer.outerWidth(),"z-index":99})),!a.fixed&&c>a.top-a.top_offset&&(a.fixed=!0,a.spacer.show(),a.node.css({position:"fixed",top:a.top_offset,left:a.spacer.offset().left,width:a.spacer.outerWidth(),"z-index":99})),a.fixed&&c<a.top-a.top_offset&&(a.fixed=!1,a.spacer.hide(),a.node.css({position:"relative",top:"",left:"",width:"","z-index":""}));this.resizing=!1},b.prototype.destroy=function(){var a;for(a=this.elements.length;a--;)this.elements[a].spacer.remove();this.window.unbind("scroll"),this.window.unbind("resize"),this.window=this.elements=null},b}())(this,b)}}(jQuery)}).call(this);